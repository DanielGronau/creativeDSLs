== Token Chain DSLs

Sometimes, all you need is to construct a sequence of elements. When there are only a few types of elements, the elements itself are easy to construct, and there are no succession rules needed, you can model this use case as a simple chain of tokens. The ingredients for this pattern are a token hierarchy, which can be modelled using sealed classes or interfaces, and a way to glue these tokens together, which can be a simple vararg function, or - more stylish - a concatenating operator.

=== Case Study: Turtle Graphics

While computer graphics (regardless of pixels or vectors) is usually operating on absolute coordinates, https://en.wikipedia.org/wiki/Turtle_graphics[Turtle Graphics] works relative to its current local position and last direction (the "cursor").

[source,kotlin]
----
import java.awt.Color

sealed interface TurtleOp

interface Motion : TurtleOp
data class F(val distance: Int): Motion // forward
data class B(val distance: Int): Motion // backward
data class R(val degrees: Int): Motion // right
data class L(val degrees: Int): Motion // left
data class Goto(val x: Int, val y: Int): Motion // set position
data class Head(val degrees: Int): Motion // set heading

interface Drawing : TurtleOp
object Down : Drawing // pen down
object Up : Drawing // pen up
data class Col(val color: Color): Drawing // set color

data class TurtleGraphic(val operations: List<TurtleOp>)

operator fun TurtleOp.unaryMinus() = TurtleGraphic(listOf(this))

operator fun TurtleGraphic.minus(turtleOp: TurtleOp) =
    this.copy(operations = operations + turtleOp)
----

Here is the code to draw a black triangle:

[source,kotlin]
----
val graph = -Col(BLACK)-
        Down-
        F(100)-L(120)-
        F(100)-L(120)-
        F(100)-L(120)-
        Up
----

=== Conclusion

The Loan Pattern DSL has several advantages over the classic Builder Pattern style, and is very common in Kotlin. It really shines when dealing with nested structures, and allows to integrate other DSL techniques more easily.

==== Preferable Use Cases

* Creating data
* Execute actions
* Configuring systems
* Testing

==== Rating

* image:5_sun.png[] - for Simplicity of DSL design
* image:3_sun.png[] - for Elegance
* image:3_sun.png[] - for Usability
* image:3_sun.png[] - for Application Scope

==== Pros & Cons

[cols="2a,2a"]
|===
|Pros |Cons

|* easy to write and read

|* succession rules can't be enforced
* might be difficult to use from Java client code
|===